_M={}function _M.parse_text_sprite_block(a,b)if string.byte(a,1)==0xFF then local c={}c.width=string.byte(a,2)<<8|string.byte(a,3)c.max_display_rows=string.byte(a,4)c.lines=string.byte(a,5)local d={}for e=0,c.lines-1 do local f={}f.x=string.byte(a,5+4*e+1)<<8|string.byte(a,5+4*e+2)f.y=string.byte(a,5+4*e+3)<<8|string.byte(a,5+4*e+4)table.insert(d,f)end;c.offsets=d;c.sprites={}c.last_sprite_index=0;c.first_sprite_index=0;return c else if b==nil then return nil end;b.last_sprite_index=b.last_sprite_index+1;if b.first_sprite_index==0 then b.first_sprite_index=1 end;if b.last_sprite_index-b.first_sprite_index+1>b.max_display_rows then b.sprites[b.first_sprite_index]=nil;b.first_sprite_index=b.first_sprite_index+1 end;local g={}g.width=string.byte(a,1)<<8|string.byte(a,2)g.height=string.byte(a,3)<<8|string.byte(a,4)g.bpp=string.byte(a,5)g.num_colors=string.byte(a,6)g.palette_data=string.sub(a,7,7+g.num_colors*3-1)g.pixel_data=string.sub(a,7+g.num_colors*3)b.sprites[b.last_sprite_index]=g;return b end end;return _M